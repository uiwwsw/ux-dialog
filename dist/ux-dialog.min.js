/*
 MIT License. 
 ux-dialog v0.1.12
 author: uiwwsw
 homepage:https://github.com/uiwwsw/ux-dialog#readme
 */ "use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var defaultText={confirm:"확인",cancel:"취소"},contentsType={confirm:"boolean",cancel:"boolean",close:"boolean",dimClose:"boolean",title:"string",content:"string",callback:"function",text:"string",selfClose:"number",closeKey:"number",cancelKey:"number",confirmKey:"number"},UxDialog=function(){function c(e){_classCallCheck(this,c),c.keyUpEvents||(c.keyUpEvents=[]),this.getDefaultContents(e||{})}return _createClass(c,[{key:"checkType",value:function(e){var c=this;Object.entries(e).map(function(e){var n=e[0],t=e[1];if("object"===_typeof(t))c.checkType(t);else{var o=contentsType[n];if(_typeof(t)!==o)throw"".concat(t,"는 ").concat(o,"이 아닙니다.")}})}},{key:"makeNode",value:function(e){var n="",t="";e.confirm&&(n='<button name="confirm" type="button">'.concat(e.confirm.text||defaultText.confirm,"</button>")),e.cancel&&(t='<button name="cancel" type="button">'.concat(e.cancel.text||defaultText.cancel,"</button>"));var o=' \n          <div class="ux-dialog">\n            <div class="ux-dialog--content">\n              <button type="button" class="ux-dialog--close" '.concat(!1===e.close&&'style="display: none;"','>this dialog close</button>\n              <div class="ux-dialog--header">').concat(e.title,'</div>\n              <div class="ux-dialog--container">').concat(e.content,'</div>\n              <div class="ux-dialog--footer">').concat(n).concat(t,'</div>\n              <i class="ux-dialog--loading"></i>\n            </div>\n            <i class="ux-dialog--dim"></i>\n          </div>\n        ');return c.htmlToElement(o)}},{key:"append",value:function(e){var n=document.body;this.element=this.makeNode(e),n.appendChild(this.element)}},{key:"getDefaultContents",value:function(e){var n=this;this.checkType(e),this.element=null,this.contents={},Object.entries(e).map(function(e){n.contents[e[0]]=e[1]})}},{key:"bindEvent",value:function(n){var t=this;window.onkeyup&&c.keyUpEvents.push(window.onkeyup),window.onkeyup=function(e){if(n.closeKey!==e.keyCode)return n.cancelKey===e.keyCode?(n.cancel.callback&&n.cancel.callback(),void t.close()):void(n.confirmKey!==e.keyCode||n.confirm.callback&&n.confirm.callback());t.close()},n.dimClose&&(this.element.querySelector(".ux-dialog--dim").onclick=function(){t.close()}),this.element.querySelector(".ux-dialog--close").onclick=function(){t.close()},this.element.querySelector(".ux-dialog--footer").onclick=function(e){switch(e.target.name){case"confirm":n.confirm.callback&&n.confirm.callback();break;case"cancel":t.close(),n.cancel.callback&&n.cancel.callback()}}}},{key:"open",value:function(e){var o=this;if(null===this.element){var c=Object.assign({},this.contents);e&&(this.checkType(e),Object.entries(e).map(function(e){var n=e[0],t=e[1];o.contents[n]!==t&&(c[n]=t)})),this.append(c),this.bindEvent(c),c.selfClose&&(clearTimeout(this.sto),this.element.querySelector(".ux-dialog--loading").style.animationDuration=c.selfClose/1e3+"s",this.sto=setTimeout(function(){o.close()},c.selfClose))}}},{key:"close",value:function(){var e=this.element;if(e){var n=c.keyUpEvents.length;window.onkeyup=n?c.keyUpEvents.pop():null,e.classList.add("close"),e.querySelector(".ux-dialog--dim").addEventListener("animationend",function(){e.remove()}),this.element=null}}}],[{key:"htmlToElement",value:function(e){var n=document.createElement("template");return e=e.trim(),n.innerHTML=e,n.content.firstChild}}]),c}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImRlZmF1bHRUZXh0IiwiY29uZmlybSIsImNhbmNlbCIsImNvbnRlbnRzVHlwZSIsImNsb3NlIiwiZGltQ2xvc2UiLCJ0aXRsZSIsImNvbnRlbnQiLCJjYWxsYmFjayIsInRleHQiLCJzZWxmQ2xvc2UiLCJjbG9zZUtleSIsImNhbmNlbEtleSIsImNvbmZpcm1LZXkiLCJVeERpYWxvZyIsImNvbnRlbnRzIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsImtleVVwRXZlbnRzIiwiZ2V0RGVmYXVsdENvbnRlbnRzIiwib2JqZWN0IiwiX3RoaXMiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwidmFsIiwia2V5IiwidmFsdWUiLCJfdHlwZW9mIiwiY2hlY2tUeXBlIiwidHlwZSIsImNvbmNhdCIsImRpYWxvZyIsImh0bWxUb0VsZW1lbnQiLCJib2R5IiwiZG9jdW1lbnQiLCJlbGVtZW50IiwibWFrZU5vZGUiLCJhcHBlbmRDaGlsZCIsIl90aGlzMiIsIl90aGlzMyIsIndpbmRvdyIsIm9ua2V5dXAiLCJwdXNoIiwiZSIsImtleUNvZGUiLCJxdWVyeVNlbGVjdG9yIiwib25jbGljayIsInRhcmdldCIsIm5hbWUiLCJfdGhpczQiLCJvbmNlIiwiYXNzaWduIiwiYXBwZW5kIiwiYmluZEV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic3RvIiwic3R5bGUiLCJhbmltYXRpb25EdXJhdGlvbiIsInNldFRpbWVvdXQiLCJrZXlVcExlbmd0aCIsImxlbmd0aCIsInBvcCIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmUiLCJzdHIiLCJ0ZW1wbGF0ZSIsImNyZWF0ZUVsZW1lbnQiLCJ0cmltIiwiaW5uZXJIVE1MIiwiZmlyc3RDaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7d29CQWtCQSxJQUFNQSxZQUFjLENBQ2hCQyxRQUFTLEtBQ1RDLE9BQVEsTUFHTkMsYUFBZSxDQUNqQkYsUUFBUyxVQUNUQyxPQUFRLFVB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U0FBQ0MsR0FDMUIsSUFBTUMsRUFBTUQsRUFBSSxHQUNWRSxFQUFRRixFQUFJLEdBQ2R5QixFQUFLbkMsU0FBU1csS0FBU0MsSUFDdkJ3QixFQUFLekIsR0FBT0MsTUFJeEJWLEtBQUtvQyxPQUFPRixHQUNabEMsS0FBS3FDLFVBQVVILEdBRVhBLEVBQUt6QyxZQUNMNkMsYUFBYXRDLEtBQUt1QyxLQUNsQnZDLEtBQUttQixRQUFRVSxjQUFjLHVCQUF1QlcsTUFBTUMsa0JBQW9CUCxFQUFLekMsVUFBWSxJQUFPLElBQ3BHTyxLQUFLdUMsSUFBTUcsV0FBVyxXQUNsQlQsRUFBSzlDLFNBQ04rQyxFQUFLekMsNkNBTWhCLElBQU0wQixFQUFVbkIsS0FBS21CLFFBQ3JCLEdBQUlBLEVBQVMsQ0FDVCxJQUFNd0IsRUFBYzlDLEVBQVNJLFlBQVkyQyxPQUVyQ3BCLE9BQU9DLFFBRFBrQixFQUNpQjlDLEVBQVNJLFlBQVk0QyxNQUVyQixLQUVyQjFCLEVBQVEyQixVQUFVQyxJQUFJLFNBQ3RCNUIsRUFBUVUsY0FBYyxtQkFBbUJtQixpQkFBaUIsZUFBZ0IsV0FDdEU3QixFQUFROEIsV0FFWmpELEtBQUttQixRQUFVLDhDQXRHRitCLEdBQ2pCLElBQU1DLEVBQVdqQyxTQUFTa0MsY0FBYyxZQUd4QyxPQUZBRixFQUFNQSxFQUFJRyxPQUNWRixFQUFTRyxVQUFZSixFQUNkQyxFQUFTN0QsUUFBUWlFIiwiZmlsZSI6InV4LWRpYWxvZy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbnRlcmZhY2UgQnV0dG9uIHtcclxuICAgIGNhbGxiYWNrPzogRnVuY3Rpb247XHJcbiAgICB0ZXh0Pzogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQ29udGVudHMge1xyXG4gICAgdGl0bGU/OiBzdHJpbmc7XHJcbiAgICBjb250ZW50Pzogc3RyaW5nIHwgTm9kZTtcclxuICAgIGNvbmZpcm0/OiBCdXR0b24gfCBudWxsO1xyXG4gICAgY2FuY2VsPzogQnV0dG9uIHwgbnVsbDtcclxuICAgIGNsb3NlPzogYm9vbGVhbjtcclxuICAgIGRpbUNsb3NlPzogYm9vbGVhbjtcclxuICAgIHNlbGZDbG9zZT86IG51bWJlcjtcclxuICAgIGNsb3NlS2V5PzogbnVtYmVyO1xyXG4gICAgY2FuY2VsS2V5PzogbnVtYmVyO1xyXG4gICAgY29uZmlybUtleT86IG51bWJlcjtcclxufVxyXG5cclxuY29uc3QgZGVmYXVsdFRleHQgPSB7XHJcbiAgICBjb25maXJtOiAn7ZmV7J24JyxcclxuICAgIGNhbmNlbDogJ+y3qOyGjCdcclxufTtcclxuXHJcbmNvbnN0IGNvbnRlbnRzVHlwZSA9IHtcclxuICAgIGNvbmZpcm06ICdib29sZWFuJyxcclxuICAgIGNhbmNlbDogJ2Jvb2xlYW4nLFxyXG4gICAgY2xvc2U6ICdib29sZWFuJyxcclxuICAgIGRpbUNsb3NlOiAnYm9vbGVhbicsXHJcbiAgICB0aXRsZTogJ3N0cmluZycsXHJcbiAgICBjb250ZW50OiAnc3RyaW5nJyxcclxuICAgIGNhbGxiYWNrOiAnZnVuY3Rpb24nLFxyXG4gICAgdGV4dDogJ3N0cmluZycsXHJcbiAgICBzZWxmQ2xvc2U6ICdudW1iZXInLFxyXG4gICAgY2xvc2VLZXk6ICdudW1iZXInLFxyXG4gICAgY2FuY2VsS2V5OiAnbnVtYmVyJyxcclxuICAgIGNvbmZpcm1LZXk6ICdudW1iZXInXHJcbn07XHJcblxyXG5jbGFzcyBVeERpYWxvZyB7XHJcbiAgICBzdGF0aWMga2V5VXBFdmVudHM6IGFueVtdO1xyXG4gICAgcHJpdmF0ZSBzdG86IGFueTtcclxuICAgIHByaXZhdGUgZWxlbWVudDogYW55O1xyXG4gICAgcHJpdmF0ZSBjb250ZW50czogQ29udGVudHM7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29udGVudHM6IENvbnRlbnRzKSB7XHJcbiAgICAgICAgaWYgKCFVeERpYWxvZy5rZXlVcEV2ZW50cykge1xyXG4gICAgICAgICAgICBVeERpYWxvZy5rZXlVcEV2ZW50cyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldERlZmF1bHRDb250ZW50cyhjb250ZW50cyB8fCB7fSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1R5cGUob2JqZWN0OiBvYmplY3QpOiB2b2lkIHtcclxuICAgICAgICBPYmplY3QuZW50cmllcyhvYmplY3QpLm1hcCgodmFsKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IHZhbFswXTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWxbMV07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrVHlwZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gY29udGVudHNUeXBlW2tleV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSB0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgYCR7dmFsdWV964qUICR7dHlwZX3snbQg7JWE64uZ64uI64ukLmBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWFrZU5vZGUoY29udGVudHM6IENvbnRlbnRzKTogYW55IHtcclxuICAgICAgICBsZXQgY29uZmlybSA9ICcnO1xyXG4gICAgICAgIGxldCBjYW5jZWwgPSAnJztcclxuICAgICAgICBpZiAoY29udGVudHMuY29uZmlybSkge1xyXG4gICAgICAgICAgICBjb25maXJtID0gYDxidXR0b24gbmFtZT1cImNvbmZpcm1cIiB0eXBlPVwiYnV0dG9uXCI+JHtjb250ZW50cy5jb25maXJtLnRleHQgfHwgZGVmYXVsdFRleHQuY29uZmlybX08L2J1dHRvbj5gXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjb250ZW50cy5jYW5jZWwpIHtcclxuICAgICAgICAgICAgY2FuY2VsID0gYDxidXR0b24gbmFtZT1cImNhbmNlbFwiIHR5cGU9XCJidXR0b25cIj4ke2NvbnRlbnRzLmNhbmNlbC50ZXh0IHx8IGRlZmF1bHRUZXh0LmNhbmNlbH08L2J1dHRvbj5gXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IGAgXHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1eC1kaWFsb2ctLWNvbnRlbnRcIj5cclxuICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInV4LWRpYWxvZy0tY2xvc2VcIiAkeyhjb250ZW50cy5jbG9zZSA9PT0gZmFsc2UpICYmICgnc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiJyl9PnRoaXMgZGlhbG9nIGNsb3NlPC9idXR0b24+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0taGVhZGVyXCI+JHtjb250ZW50cy50aXRsZX08L2Rpdj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1jb250YWluZXJcIj4ke2NvbnRlbnRzLmNvbnRlbnR9PC9kaXY+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tZm9vdGVyXCI+JHtjb25maXJtfSR7Y2FuY2VsfTwvZGl2PlxyXG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwidXgtZGlhbG9nLS1sb2FkaW5nXCI+PC9pPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPGkgY2xhc3M9XCJ1eC1kaWFsb2ctLWRpbVwiPjwvaT5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIGA7XHJcbiAgICAgICAgcmV0dXJuIFV4RGlhbG9nLmh0bWxUb0VsZW1lbnQoZGlhbG9nKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaHRtbFRvRWxlbWVudChzdHI6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xyXG4gICAgICAgIHN0ciA9IHN0ci50cmltKCk7XHJcbiAgICAgICAgdGVtcGxhdGUuaW5uZXJIVE1MID0gc3RyO1xyXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZS5jb250ZW50LmZpcnN0Q2hpbGQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcHBlbmQoY29udGVudHM6IENvbnRlbnRzKSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5tYWtlTm9kZShjb250ZW50cyk7XHJcbiAgICAgICAgYm9keS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzOiBDb250ZW50cyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2hlY2tUeXBlKGNvbnRlbnRzKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY29udGVudHMgPSB7fTtcclxuICAgICAgICBPYmplY3QuZW50cmllcyhjb250ZW50cykubWFwKCh2YWwpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50c1t2YWxbMF1dID0gdmFsWzFdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEV2ZW50KGNvbnRlbnRzPzogQ29udGVudHMpIHtcclxuICAgICAgICBpZiAod2luZG93Lm9ua2V5dXApIHtcclxuICAgICAgICAgICAgVXhEaWFsb2cua2V5VXBFdmVudHMucHVzaCh3aW5kb3cub25rZXl1cCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdpbmRvdy5vbmtleXVwID0gZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jbG9zZUtleSA9PT0gZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNhbmNlbEtleSA9PT0gZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jb25maXJtS2V5ID09PSBlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgICAgIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaygpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbnRlbnRzLmRpbUNsb3NlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tY2xvc2UnKS5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tZm9vdGVyJykub25jbGljayA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBlLnRhcmdldC5uYW1lO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbmZpcm0nOlxyXG4gICAgICAgICAgICAgICAgICAgIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaygpKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2spICYmIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2soKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9wZW4oY29udGVudHM/OiBDb250ZW50cyk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgbGV0IG9uY2U6IENvbnRlbnRzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jb250ZW50cyk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50cykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1R5cGUoY29udGVudHMpO1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoY29udGVudHMpLm1hcCgodmFsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gdmFsWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdmFsWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRzW2tleV0gIT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2Vba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kKG9uY2UpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRFdmVudChvbmNlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvbmNlLnNlbGZDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc3RvKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1sb2FkaW5nJykuc3R5bGUuYW5pbWF0aW9uRHVyYXRpb24gPSBvbmNlLnNlbGZDbG9zZSAvIDEwMDAgKyAncyc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0byA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0sIG9uY2Uuc2VsZkNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xvc2UoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBjb25zdCBrZXlVcExlbmd0aCA9IFV4RGlhbG9nLmtleVVwRXZlbnRzLmxlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGtleVVwTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub25rZXl1cCA9IFV4RGlhbG9nLmtleVVwRXZlbnRzLnBvcCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==
