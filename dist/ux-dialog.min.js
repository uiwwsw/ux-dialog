/*
 MIT License. 
 ux-dialog v0.1.14
 author: uiwwsw
 homepage:https://github.com/uiwwsw/ux-dialog#readme
 */ "use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var defaultText={confirm:"확인",cancel:"취소"},contentsType={confirm:"boolean",cancel:"boolean",close:"boolean",dimClose:"boolean",title:"string",content:"string",callback:"function",text:"string",selfClose:"number",closeKey:"number",cancelKey:"number",confirmKey:"number",opend:"function",closed:"function"},UxDialog=function(){function c(e){_classCallCheck(this,c),c.keyUpEvents||(c.keyUpEvents=[]),this.getDefaultContents(e||{})}return _createClass(c,[{key:"checkType",value:function(e){var c=this;Object.entries(e).map(function(e){var n=e[0],t=e[1];if("object"===_typeof(t))c.checkType(t);else{var o=contentsType[n];if(_typeof(t)!==o)throw"".concat(t,"는 ").concat(o,"이 아닙니다.")}})}},{key:"makeNode",value:function(e){var n="",t="";e.confirm&&(n='<button name="confirm" type="button">'.concat(e.confirm.text||defaultText.confirm,"</button>")),e.cancel&&(t='<button name="cancel" type="button">'.concat(e.cancel.text||defaultText.cancel,"</button>"));var o=' \n          <div class="ux-dialog">\n            <div class="ux-dialog--content">\n              <button type="button" class="ux-dialog--close" '.concat(!1===e.close&&'style="display: none;"','>this dialog close</button>\n              <div class="ux-dialog--header">').concat(e.title,'</div>\n              <div class="ux-dialog--container">').concat(e.content,'</div>\n              <div class="ux-dialog--footer">').concat(n).concat(t,'</div>\n              <i class="ux-dialog--loading"></i>\n            </div>\n            <i class="ux-dialog--dim"></i>\n          </div>\n        ');return c.htmlToElement(o)}},{key:"append",value:function(e){var n=document.body;this.element=this.makeNode(e),n.appendChild(this.element)}},{key:"getDefaultContents",value:function(e){var n=this;this.checkType(e),this.element=null,this.contents={},Object.entries(e).map(function(e){n.contents[e[0]]=e[1]})}},{key:"bindEvent",value:function(n){var t=this;window.onkeyup&&c.keyUpEvents.push(window.onkeyup),window.onkeyup=function(e){if(n.closeKey!==e.keyCode)return n.cancelKey===e.keyCode?(n.cancel.callback&&n.cancel.callback(),void t.close()):void(n.confirmKey!==e.keyCode||n.confirm.callback&&n.confirm.callback());t.close()},n.dimClose&&(this.element.querySelector(".ux-dialog--dim").onclick=function(){t.close()}),this.element.querySelector(".ux-dialog--close").onclick=function(){t.close()},this.element.querySelector(".ux-dialog--footer").onclick=function(e){switch(e.target.name){case"confirm":n.confirm.callback&&n.confirm.callback();break;case"cancel":t.close(),n.cancel.callback&&n.cancel.callback()}}}},{key:"open",value:function(e){var o=this;if(null===this.element){var c=Object.assign({},this.contents);if(e&&(this.checkType(e),Object.entries(e).map(function(e){var n=e[0],t=e[1];o.contents[n]!==t&&(c[n]=t)})),this.append(c),this.bindEvent(c),c.opend){this.element.querySelector(".ux-dialog--dim").addEventListener("animationend",function e(){o.element.querySelector(".ux-dialog--dim").removeEventListener("animationend",e),c.opend()})}c.selfClose&&(clearTimeout(this.sto),this.element.querySelector(".ux-dialog--loading").style.animationDuration=c.selfClose/1e3+"s",this.sto=setTimeout(function(){o.close()},c.selfClose))}}},{key:"close",value:function(e){var n=this,t=this.element;if(t){var o=c.keyUpEvents.length;window.onkeyup=o?c.keyUpEvents.pop():null,t.classList.add("close"),t.querySelector(".ux-dialog--dim").addEventListener("animationend",function(){n.contents.closed&&n.contents.closed(),e&&e(),t.remove()}),this.element=null}}}],[{key:"htmlToElement",value:function(e){var n=document.createElement("template");return e=e.trim(),n.innerHTML=e,n.content.firstChild}}]),c}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImRlZmF1bHRUZXh0IiwiY29uZmlybSIsImNhbmNlbCIsImNvbnRlbnRzVHlwZSIsImNsb3NlIiwiZGltQ2xvc2UiLCJ0aXRsZSIsImNvbnRlbnQiLCJjYWxsYmFjayIsInRleHQiLCJzZWxmQ2xvc2UiLCJjbG9zZUtleSIsImNhbmNlbEtleSIsImNvbmZpcm1LZXkiLCJvcGVuZCIsImNsb3NlZCIsIlV4RGlhbG9nIiwiY29udGVudHMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwia2V5VXBFdmVudHMiLCJnZXREZWZhdWx0Q29udGVudHMiLCJvYmplY3QiLCJfdGhpcyIsIk9iamVjdCIsImVudHJpZXMiLCJtYXAiLCJ2YWwiLCJrZXkiLCJ2YWx1ZSIsIl90eXBlb2YiLCJjaGVja1R5cGUiLCJ0eXBlIiwiY29uY2F0IiwiZGlhbG9nIiwiaHRtbFRvRWxlbWVudCIsImJvZHkiLCJkb2N1bWVudCIsImVsZW1lbnQiLCJtYWtlTm9kZSIsImFwcGVuZENoaWxkIiwiX3RoaXMyIiwiX3RoaXMzIiwid2luZG93Iiwib25rZXl1cCIsInB1c2giLCJlIiwia2V5Q29kZSIsInF1ZXJ5U2VsZWN0b3IiLCJvbmNsaWNrIiwidGFyZ2V0IiwibmFtZSIsIl90aGlzNCIsIm9uY2UiLCJhc3NpZ24iLCJhcHBlbmQiLCJiaW5kRXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYWN0aW9uIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNsZWFyVGltZW91dCIsInN0byIsInN0eWxlIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJzZXRUaW1lb3V0IiwiX3RoaXM1Iiwia2V5VXBMZW5ndGgiLCJsZW5ndGgiLCJwb3AiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJzdHIiLCJ0ZW1wbGF0ZSIsImNyZWF0ZUVsZW1lbnQiLCJ0cmltIiwiaW5uZXJIVE1MIiwiZmlyc3RDaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7d29CQW9CQSxJQUFNQSxZQUFjLENB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QVFzRSIsImZpbGUiOiJ1eC1kaWFsb2cubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIEJ1dHRvbiB7XG4gICAgY2FsbGJhY2s/OiBGdW5jdGlvbjtcbiAgICB0ZXh0Pzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ29udGVudHMge1xuICAgIHRpdGxlPzogc3RyaW5nO1xuICAgIGNvbnRlbnQ/OiBzdHJpbmcgfCBOb2RlO1xuICAgIGNvbmZpcm0/OiBCdXR0b24gfCBudWxsO1xuICAgIGNhbmNlbD86IEJ1dHRvbiB8IG51bGw7XG4gICAgY2xvc2U/OiBib29sZWFuO1xuICAgIGRpbUNsb3NlPzogYm9vbGVhbjtcbiAgICBzZWxmQ2xvc2U/OiBudW1iZXI7XG4gICAgY2xvc2VLZXk/OiBudW1iZXI7XG4gICAgY2FuY2VsS2V5PzogbnVtYmVyO1xuICAgIGNvbmZpcm1LZXk/OiBudW1iZXI7XG4gICAgb3BlbmQ/OiBGdW5jdGlvbjtcbiAgICBjbG9zZWQ/OiBGdW5jdGlvbjtcbn1cblxuY29uc3QgZGVmYXVsdFRleHQgPSB7XG4gICAgY29uZmlybTogJ+2ZleyduCcsXG4gICAgY2FuY2VsOiAn7Leo7IaMJ1xufTtcblxuY29uc3QgY29udGVudHNUeXBlID0ge1xuICAgIGNvbmZpcm06ICdib29sZWFuJyxcbiAgICBjYW5jZWw6ICdib29sZWFuJyxcbiAgICBjbG9zZTogJ2Jvb2xlYW4nLFxuICAgIGRpbUNsb3NlOiAnYm9vbGVhbicsXG4gICAgdGl0bGU6ICdzdHJpbmcnLFxuICAgIGNvbnRlbnQ6ICdzdHJpbmcnLFxuICAgIGNhbGxiYWNrOiAnZnVuY3Rpb24nLFxuICAgIHRleHQ6ICdzdHJpbmcnLFxuICAgIHNlbGZDbG9zZTogJ251bWJlcicsXG4gICAgY2xvc2VLZXk6ICdudW1iZXInLFxuICAgIGNhbmNlbEtleTogJ251bWJlcicsXG4gICAgY29uZmlybUtleTogJ251bWJlcicsXG4gICAgb3BlbmQ6ICdmdW5jdGlvbicsXG4gICAgY2xvc2VkOiAnZnVuY3Rpb24nLFxufTtcblxuY2xhc3MgVXhEaWFsb2cge1xuICAgIHN0YXRpYyBrZXlVcEV2ZW50czogYW55W107XG4gICAgcHJpdmF0ZSBzdG86IGFueTtcbiAgICBwcml2YXRlIGVsZW1lbnQ6IGFueTtcbiAgICBwcml2YXRlIGNvbnRlbnRzOiBDb250ZW50cztcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRlbnRzOiBDb250ZW50cykge1xuICAgICAgICBpZiAoIVV4RGlhbG9nLmtleVVwRXZlbnRzKSB7XG4gICAgICAgICAgICBVeERpYWxvZy5rZXlVcEV2ZW50cyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzIHx8IHt9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrVHlwZShvYmplY3Q6IG9iamVjdCk6IHZvaWQge1xuICAgICAgICBPYmplY3QuZW50cmllcyhvYmplY3QpLm1hcCgodmFsKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSB2YWxbMF07XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbFsxXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1R5cGUodmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gY29udGVudHNUeXBlW2tleV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBgJHt2YWx1ZX3ripQgJHt0eXBlfeydtCDslYTri5nri4jri6QuYFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtYWtlTm9kZShjb250ZW50czogQ29udGVudHMpOiBhbnkge1xuICAgICAgICBsZXQgY29uZmlybSA9ICcnO1xuICAgICAgICBsZXQgY2FuY2VsID0gJyc7XG4gICAgICAgIGlmIChjb250ZW50cy5jb25maXJtKSB7XG4gICAgICAgICAgICBjb25maXJtID0gYDxidXR0b24gbmFtZT1cImNvbmZpcm1cIiB0eXBlPVwiYnV0dG9uXCI+JHtjb250ZW50cy5jb25maXJtLnRleHQgfHwgZGVmYXVsdFRleHQuY29uZmlybX08L2J1dHRvbj5gXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRlbnRzLmNhbmNlbCkge1xuICAgICAgICAgICAgY2FuY2VsID0gYDxidXR0b24gbmFtZT1cImNhbmNlbFwiIHR5cGU9XCJidXR0b25cIj4ke2NvbnRlbnRzLmNhbmNlbC50ZXh0IHx8IGRlZmF1bHRUZXh0LmNhbmNlbH08L2J1dHRvbj5gXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGlhbG9nID0gYCBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1jb250ZW50XCI+XG4gICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwidXgtZGlhbG9nLS1jbG9zZVwiICR7KGNvbnRlbnRzLmNsb3NlID09PSBmYWxzZSkgJiYgKCdzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCInKX0+dGhpcyBkaWFsb2cgY2xvc2U8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0taGVhZGVyXCI+JHtjb250ZW50cy50aXRsZX08L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tY29udGFpbmVyXCI+JHtjb250ZW50cy5jb250ZW50fTwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1mb290ZXJcIj4ke2NvbmZpcm19JHtjYW5jZWx9PC9kaXY+XG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwidXgtZGlhbG9nLS1sb2FkaW5nXCI+PC9pPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8aSBjbGFzcz1cInV4LWRpYWxvZy0tZGltXCI+PC9pPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgICAgICByZXR1cm4gVXhEaWFsb2cuaHRtbFRvRWxlbWVudChkaWFsb2cpO1xuICAgIH1cblxuICAgIHN0YXRpYyBodG1sVG9FbGVtZW50KHN0cjogc3RyaW5nKTogYW55IHtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgICAgICBzdHIgPSBzdHIudHJpbSgpO1xuICAgICAgICB0ZW1wbGF0ZS5pbm5lckhUTUwgPSBzdHI7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZS5jb250ZW50LmZpcnN0Q2hpbGQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhcHBlbmQoY29udGVudHM6IENvbnRlbnRzKSB7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5O1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLm1ha2VOb2RlKGNvbnRlbnRzKTtcbiAgICAgICAgYm9keS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzOiBDb250ZW50cyk6IHZvaWQge1xuICAgICAgICB0aGlzLmNoZWNrVHlwZShjb250ZW50cyk7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgICAgIHRoaXMuY29udGVudHMgPSB7fTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoY29udGVudHMpLm1hcCgodmFsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRzW3ZhbFswXV0gPSB2YWxbMV07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgYmluZEV2ZW50KGNvbnRlbnRzPzogQ29udGVudHMpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5vbmtleXVwKSB7XG4gICAgICAgICAgICBVeERpYWxvZy5rZXlVcEV2ZW50cy5wdXNoKHdpbmRvdy5vbmtleXVwKTtcbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cub25rZXl1cCA9IGUgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNsb3NlS2V5ID09PSBlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNhbmNlbEtleSA9PT0gZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaykgJiYgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaygpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNvbmZpcm1LZXkgPT09IGUua2V5Q29kZSkge1xuICAgICAgICAgICAgICAgIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaygpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChjb250ZW50cy5kaW1DbG9zZSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tY2xvc2UnKS5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tZm9vdGVyJykub25jbGljayA9IChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gZS50YXJnZXQubmFtZTtcbiAgICAgICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbmZpcm0nOlxuICAgICAgICAgICAgICAgICAgICAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaykgJiYgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2soKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NhbmNlbCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaykgJiYgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaygpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb3Blbihjb250ZW50cz86IENvbnRlbnRzKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBvbmNlOiBDb250ZW50cyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29udGVudHMpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1R5cGUoY29udGVudHMpO1xuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGNvbnRlbnRzKS5tYXAoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB2YWxbMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdmFsWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250ZW50c1trZXldICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25jZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYXBwZW5kKG9uY2UpO1xuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQob25jZSk7XG4gICAgICAgICAgICBpZiAob25jZS5vcGVuZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FuaW1hdGlvbmVuZCcsIGFjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIG9uY2Uub3BlbmQoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCBhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9uY2Uuc2VsZkNsb3NlKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc3RvKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tbG9hZGluZycpLnN0eWxlLmFuaW1hdGlvbkR1cmF0aW9uID0gb25jZS5zZWxmQ2xvc2UgLyAxMDAwICsgJ3MnO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9LCBvbmNlLnNlbGZDbG9zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2xvc2UoY2FsbGJhY2s/OiBGdW5jdGlvbik6IHZvaWQge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3Qga2V5VXBMZW5ndGggPSBVeERpYWxvZy5rZXlVcEV2ZW50cy5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoa2V5VXBMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub25rZXl1cCA9IFV4RGlhbG9nLmtleVVwRXZlbnRzLnBvcCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub25rZXl1cCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Nsb3NlJyk7XG4gICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLmFkZEV2ZW50TGlzdGVuZXIoJ2FuaW1hdGlvbmVuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250ZW50cy5jbG9zZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZW50cy5jbG9zZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbiJdfQ==
