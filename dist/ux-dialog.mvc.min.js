/*
 MIT License. 
 ux-dialog v0.1.11
 author: uiwwsw
 homepage:https://github.com/uiwwsw/ux-dialog#readme
 */ "use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var defaultText={confirm:"확인",cancel:"취소"},contentsType={confirm:"boolean",cancel:"boolean",close:"boolean",dimClose:"boolean",title:"string",content:"string",callback:"function",text:"string",selfClose:"number",closeKey:"number",cancelKey:"number",confirmKey:"number"},UxDialog=function(){function c(e){_classCallCheck(this,c),c.keyUpEvents||(c.keyUpEvents=[]),this.getDefaultContents(e||{})}return _createClass(c,[{key:"checkType",value:function(e){var c=this;Object.entries(e).map(function(e){var t=e[0],n=e[1];if("object"===_typeof(n))c.checkType(n);else{var o=contentsType[t];if(_typeof(n)!==o)throw"".concat(n,"는 ").concat(o,"이 아닙니다.")}})}},{key:"makeNode",value:function(e){var t="",n="";e.confirm&&(t='<button name="confirm" type="button">'.concat(e.confirm.text||defaultText.confirm,"</button>")),e.cancel&&(n='<button name="cancel" type="button">'.concat(e.cancel.text||defaultText.cancel,"</button>"));var o=' \n          <div class="ux-dialog">\n            <div class="ux-dialog--content">\n              <button type="button" class="ux-dialog--close" '.concat(!1===e.close&&'style="display: none;"','>this dialog close</button>\n              <div class="ux-dialog--header">').concat(e.title,'</div>\n              <div class="ux-dialog--container">').concat(e.content,'</div>\n              <div class="ux-dialog--footer">').concat(t).concat(n,'</div>\n              <i class="ux-dialog--loading"></i>\n            </div>\n            <i class="ux-dialog--dim"></i>\n          </div>\n        ');return c.htmlToElement(o)}},{key:"append",value:function(e){var t=document.body;this.element=this.makeNode(e),t.appendChild(this.element)}},{key:"getDefaultContents",value:function(e){var t=this;this.checkType(e),this.element=null,this.contents={},Object.entries(e).map(function(e){t.contents[e[0]]=e[1]})}},{key:"bindEvent",value:function(t){var n=this;window.onkeyup&&c.keyUpEvents.push(window.onkeyup),window.onkeyup=function(e){if(t.closeKey!==e.keyCode)return t.cancelKey===e.keyCode?(t.cancel.callback&&t.cancel.callback(),void n.close()):void(t.confirmKey!==e.keyCode||t.confirm.callback&&t.confirm.callback());n.close()},t.dimClose&&(this.element.querySelector(".ux-dialog--dim").onclick=function(){n.close()}),this.element.querySelector(".ux-dialog--close").onclick=function(){n.close()},this.element.querySelector(".ux-dialog--footer").onclick=function(e){switch(e.target.name){case"confirm":t.confirm.callback&&t.confirm.callback();break;case"cancel":n.close(),t.cancel.callback&&t.cancel.callback()}}}},{key:"open",value:function(e){var o=this;if(null===this.element){var c=Object.assign({},this.contents);e&&(this.checkType(e),Object.entries(e).map(function(e){var t=e[0],n=e[1];o.contents[t]!==n&&(c[t]=n)})),this.append(c),this.bindEvent(c),c.selfClose&&(clearTimeout(this.sto),this.element.querySelector(".ux-dialog--loading").style.animationDuration=c.selfClose/1e3+"s",this.sto=setTimeout(function(){o.close()},c.selfClose))}}},{key:"close",value:function(){var e=this.element;if(e){var t=c.keyUpEvents.length;window.onkeyup=t?c.keyUpEvents.pop():null,e.classList.add("close"),e.querySelector(".ux-dialog--dim").addEventListener("animationend",function(){e.remove()}),this.element=null}}}],[{key:"htmlToElement",value:function(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}}]),c}(),_default=UxDialog;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImRlZmF1bHRUZXh0IiwiY29uZmlybSIsImNhbmNlbCIsImNvbnRlbnRzVHlwZSIsImNsb3NlIiwiZGltQ2xvc2UiLCJ0aXRsZSIsImNvbnRlbnQiLCJjYWxsYmFjayIsInRleHQiLCJzZWxmQ2xvc2UiLCJjbG9zZUtleSIsImNhbmNlbEtleSIsImNvbmZpcm1LZXkiLCJVeERpYWxvZyIsImNvbnRlbnRzIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsImtleVVwRXZlbnRzIiwiZ2V0RGVmYXVsdENvbnRlbnRzIiwib2JqZWN0IiwiX3RoaXMiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwidmFsIiwia2V5IiwidmFsdWUiLCJfdHlwZW9mIiwiY2hlY2tUeXBlIiwidHlwZSIsImNvbmNhdCIsImRpYWxvZyIsImh0bWxUb0VsZW1lbnQiLCJib2R5IiwiZG9jdW1lbnQiLCJlbGVtZW50IiwibWFrZU5vZGUiLCJhcHBlbmRDaGlsZCIsIl90aGlzMiIsIl90aGlzMyIsIndpbmRvdyIsIm9ua2V5dXAiLCJwdXNoIiwiZSIsImtleUNvZGUiLCJxdWVyeVNlbGVjdG9yIiwib25jbGljayIsInRhcmdldCIsIm5hbWUiLCJfdGhpczQiLCJvbmNlIiwiYXNzaWduIiwiYXBwZW5kIiwiYmluZEV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic3RvIiwic3R5bGUiLCJhbmltYXRpb25EdXJhdGlvbiIsInNldFRpbWVvdXQiLCJrZXlVcExlbmd0aCIsImxlbmd0aCIsInBvcCIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmUiLCJzdHIiLCJ0ZW1wbGF0ZSIsImNyZWF0ZUVsZW1lbnQiLCJ0cmltIiwiaW5uZXJIVE1MIiwiZmlyc3RDaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7c3RCQWtCQSxJQUFNQSxZQUFjLENBQ2hCQyxRQUFTLEtBQ1RDLE9BQVEsTUFHTkMsYUFBZSxDQUNqQkYsUUFBUyxVQUNUQyxPQUFRLFVB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U0FBQ0MsR0FDMUIsSUFBTUMsRUFBTUQsRUFBSSxHQUNWRSxFQUFRRixFQUFJLEdBQ2R5QixFQUFLbkMsU0FBU1csS0FBU0MsSUFDdkJ3QixFQUFLekIsR0FBT0MsTUFJeEJWLEtBQUtvQyxPQUFPRixHQUNabEMsS0FBS3FDLFVBQVVILEdBRVhBLEVBQUt6QyxZQUNMNkMsYUFBYXRDLEtBQUt1QyxLQUNsQnZDLEtBQUttQixRQUFRVSxjQUFjLHVCQUF1QlcsTUFBTUMsa0JBQW9CUCxFQUFLekMsVUFBWSxJQUFPLElBQ3BHTyxLQUFLdUMsSUFBTUcsV0FBVyxXQUNsQlQsRUFBSzlDLFNBQ04rQyxFQUFLekMsNkNBTWhCLElBQU0wQixFQUFVbkIsS0FBS21CLFFBQ3JCLEdBQUlBLEVBQVMsQ0FDVCxJQUFNd0IsRUFBYzlDLEVBQVNJLFlBQVkyQyxPQUVyQ3BCLE9BQU9DLFFBRFBrQixFQUNpQjlDLEVBQVNJLFlBQVk0QyxNQUVyQixLQUVyQjFCLEVBQVEyQixVQUFVQyxJQUFJLFNBQ3RCNUIsRUFBUVUsY0FBYyxtQkFBbUJtQixpQkFBaUIsZUFBZ0IsV0FDdEU3QixFQUFROEIsV0FFWmpELEtBQUttQixRQUFVLDhDQXRHRitCLEdBQ2pCLElBQU1DLEVBQVdqQyxTQUFTa0MsY0FBYyxZQUd4QyxPQUZBRixFQUFNQSxFQUFJRyxPQUNWRixFQUFTRyxVQUFZSixFQUNkQyxFQUFTN0QsUUFBUWlFLDZCQTZEaEJyQiIsImZpbGUiOiJ1eC1kaWFsb2cubXZjLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImludGVyZmFjZSBCdXR0b24ge1xyXG4gICAgY2FsbGJhY2s/OiBGdW5jdGlvbjtcclxuICAgIHRleHQ/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb250ZW50cyB7XHJcbiAgICB0aXRsZT86IHN0cmluZztcclxuICAgIGNvbnRlbnQ/OiBzdHJpbmcgfCBOb2RlO1xyXG4gICAgY29uZmlybT86IEJ1dHRvbiB8IG51bGw7XHJcbiAgICBjYW5jZWw/OiBCdXR0b24gfCBudWxsO1xyXG4gICAgY2xvc2U/OiBib29sZWFuO1xyXG4gICAgZGltQ2xvc2U/OiBib29sZWFuO1xyXG4gICAgc2VsZkNsb3NlPzogbnVtYmVyO1xyXG4gICAgY2xvc2VLZXk/OiBudW1iZXI7XHJcbiAgICBjYW5jZWxLZXk/OiBudW1iZXI7XHJcbiAgICBjb25maXJtS2V5PzogbnVtYmVyO1xyXG59XHJcblxyXG5jb25zdCBkZWZhdWx0VGV4dCA9IHtcclxuICAgIGNvbmZpcm06ICftmZXsnbgnLFxyXG4gICAgY2FuY2VsOiAn7Leo7IaMJ1xyXG59O1xyXG5cclxuY29uc3QgY29udGVudHNUeXBlID0ge1xyXG4gICAgY29uZmlybTogJ2Jvb2xlYW4nLFxyXG4gICAgY2FuY2VsOiAnYm9vbGVhbicsXHJcbiAgICBjbG9zZTogJ2Jvb2xlYW4nLFxyXG4gICAgZGltQ2xvc2U6ICdib29sZWFuJyxcclxuICAgIHRpdGxlOiAnc3RyaW5nJyxcclxuICAgIGNvbnRlbnQ6ICdzdHJpbmcnLFxyXG4gICAgY2FsbGJhY2s6ICdmdW5jdGlvbicsXHJcbiAgICB0ZXh0OiAnc3RyaW5nJyxcclxuICAgIHNlbGZDbG9zZTogJ251bWJlcicsXHJcbiAgICBjbG9zZUtleTogJ251bWJlcicsXHJcbiAgICBjYW5jZWxLZXk6ICdudW1iZXInLFxyXG4gICAgY29uZmlybUtleTogJ251bWJlcidcclxufTtcclxuXHJcbmNsYXNzIFV4RGlhbG9nIHtcclxuICAgIHN0YXRpYyBrZXlVcEV2ZW50czogYW55W107XHJcbiAgICBwcml2YXRlIHN0bzogYW55O1xyXG4gICAgcHJpdmF0ZSBlbGVtZW50OiBhbnk7XHJcbiAgICBwcml2YXRlIGNvbnRlbnRzOiBDb250ZW50cztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihjb250ZW50czogQ29udGVudHMpIHtcclxuICAgICAgICBpZiAoIVV4RGlhbG9nLmtleVVwRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIFV4RGlhbG9nLmtleVVwRXZlbnRzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzIHx8IHt9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrVHlwZShvYmplY3Q6IG9iamVjdCk6IHZvaWQge1xyXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKG9iamVjdCkubWFwKCh2YWwpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0gdmFsWzBdO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbFsxXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tUeXBlKHZhbHVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBjb250ZW50c1R5cGVba2V5XTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBgJHt2YWx1ZX3ripQgJHt0eXBlfeydtCDslYTri5nri4jri6QuYFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtYWtlTm9kZShjb250ZW50czogQ29udGVudHMpOiBhbnkge1xyXG4gICAgICAgIGxldCBjb25maXJtID0gJyc7XHJcbiAgICAgICAgbGV0IGNhbmNlbCA9ICcnO1xyXG4gICAgICAgIGlmIChjb250ZW50cy5jb25maXJtKSB7XHJcbiAgICAgICAgICAgIGNvbmZpcm0gPSBgPGJ1dHRvbiBuYW1lPVwiY29uZmlybVwiIHR5cGU9XCJidXR0b25cIj4ke2NvbnRlbnRzLmNvbmZpcm0udGV4dCB8fCBkZWZhdWx0VGV4dC5jb25maXJtfTwvYnV0dG9uPmBcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbnRlbnRzLmNhbmNlbCkge1xyXG4gICAgICAgICAgICBjYW5jZWwgPSBgPGJ1dHRvbiBuYW1lPVwiY2FuY2VsXCIgdHlwZT1cImJ1dHRvblwiPiR7Y29udGVudHMuY2FuY2VsLnRleHQgfHwgZGVmYXVsdFRleHQuY2FuY2VsfTwvYnV0dG9uPmBcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGlhbG9nID0gYCBcclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1eC1kaWFsb2dcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tY29udGVudFwiPlxyXG4gICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwidXgtZGlhbG9nLS1jbG9zZVwiICR7KGNvbnRlbnRzLmNsb3NlID09PSBmYWxzZSkgJiYgKCdzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCInKX0+dGhpcyBkaWFsb2cgY2xvc2U8L2J1dHRvbj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1oZWFkZXJcIj4ke2NvbnRlbnRzLnRpdGxlfTwvZGl2PlxyXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1eC1kaWFsb2ctLWNvbnRhaW5lclwiPiR7Y29udGVudHMuY29udGVudH08L2Rpdj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1mb290ZXJcIj4ke2NvbmZpcm19JHtjYW5jZWx9PC9kaXY+XHJcbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCJ1eC1kaWFsb2ctLWxvYWRpbmdcIj48L2k+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cInV4LWRpYWxvZy0tZGltXCI+PC9pPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgYDtcclxuICAgICAgICByZXR1cm4gVXhEaWFsb2cuaHRtbFRvRWxlbWVudChkaWFsb2cpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBodG1sVG9FbGVtZW50KHN0cjogc3RyaW5nKTogYW55IHtcclxuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XHJcbiAgICAgICAgc3RyID0gc3RyLnRyaW0oKTtcclxuICAgICAgICB0ZW1wbGF0ZS5pbm5lckhUTUwgPSBzdHI7XHJcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlLmNvbnRlbnQuZmlyc3RDaGlsZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFwcGVuZChjb250ZW50czogQ29udGVudHMpIHtcclxuICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLm1ha2VOb2RlKGNvbnRlbnRzKTtcclxuICAgICAgICBib2R5LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZWZhdWx0Q29udGVudHMoY29udGVudHM6IENvbnRlbnRzKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jaGVja1R5cGUoY29udGVudHMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jb250ZW50cyA9IHt9O1xyXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGNvbnRlbnRzKS5tYXAoKHZhbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRzW3ZhbFswXV0gPSB2YWxbMV07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnQoY29udGVudHM/OiBDb250ZW50cykge1xyXG4gICAgICAgIGlmICh3aW5kb3cub25rZXl1cCkge1xyXG4gICAgICAgICAgICBVeERpYWxvZy5rZXlVcEV2ZW50cy5wdXNoKHdpbmRvdy5vbmtleXVwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBlID0+IHtcclxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNsb3NlS2V5ID09PSBlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29udGVudHMuY2FuY2VsS2V5ID09PSBlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgICAgIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2spICYmIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2soKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzLmNvbmZpcm1LZXkgPT09IGUua2V5Q29kZSkge1xyXG4gICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2spICYmIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKCkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoY29udGVudHMuZGltQ2xvc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1jbG9zZScpLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1mb290ZXInKS5vbmNsaWNrID0gKGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGUudGFyZ2V0Lm5hbWU7XHJcbiAgICAgICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29uZmlybSc6XHJcbiAgICAgICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2spICYmIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY2FuY2VsJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaykgJiYgKGNvbnRlbnRzLmNhbmNlbC5jYWxsYmFjaygpKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb3Blbihjb250ZW50cz86IENvbnRlbnRzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBsZXQgb25jZTogQ29udGVudHMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbnRlbnRzKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrVHlwZShjb250ZW50cyk7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhjb250ZW50cykubWFwKCh2YWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB2YWxbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWxbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudHNba2V5XSAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25jZVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hcHBlbmQob25jZSk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50KG9uY2UpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9uY2Uuc2VsZkNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zdG8pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWxvYWRpbmcnKS5zdHlsZS5hbmltYXRpb25EdXJhdGlvbiA9IG9uY2Uuc2VsZkNsb3NlIC8gMTAwMCArICdzJztcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSwgb25jZS5zZWxmQ2xvc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbG9zZSgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xyXG4gICAgICAgIGlmIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleVVwTGVuZ3RoID0gVXhEaWFsb2cua2V5VXBFdmVudHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAoa2V5VXBMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5vbmtleXVwID0gVXhEaWFsb2cua2V5VXBFdmVudHMucG9wKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub25rZXl1cCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjbG9zZScpO1xyXG4gICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLmFkZEV2ZW50TGlzdGVuZXIoJ2FuaW1hdGlvbmVuZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuIl19
