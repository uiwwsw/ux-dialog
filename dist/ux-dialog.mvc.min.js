/*
 MIT License. 
 ux-dialog v0.1.14
 author: uiwwsw
 homepage:https://github.com/uiwwsw/ux-dialog#readme
 */ "use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var defaultText={confirm:"확인",cancel:"취소"},contentsType={confirm:"boolean",cancel:"boolean",close:"boolean",dimClose:"boolean",title:"string",content:"string",callback:"function",text:"string",selfClose:"number",closeKey:"number",cancelKey:"number",confirmKey:"number",opend:"function",closed:"function"},UxDialog=function(){function c(e){_classCallCheck(this,c),c.keyUpEvents||(c.keyUpEvents=[]),this.getDefaultContents(e||{})}return _createClass(c,[{key:"checkType",value:function(e){var c=this;Object.entries(e).map(function(e){var n=e[0],t=e[1];if("object"===_typeof(t))c.checkType(t);else{var o=contentsType[n];if(_typeof(t)!==o)throw"".concat(t,"는 ").concat(o,"이 아닙니다.")}})}},{key:"makeNode",value:function(e){var n="",t="";e.confirm&&(n='<button name="confirm" type="button">'.concat(e.confirm.text||defaultText.confirm,"</button>")),e.cancel&&(t='<button name="cancel" type="button">'.concat(e.cancel.text||defaultText.cancel,"</button>"));var o=' \n          <div class="ux-dialog">\n            <div class="ux-dialog--content">\n              <button type="button" class="ux-dialog--close" '.concat(!1===e.close&&'style="display: none;"','>this dialog close</button>\n              <div class="ux-dialog--header">').concat(e.title,'</div>\n              <div class="ux-dialog--container">').concat(e.content,'</div>\n              <div class="ux-dialog--footer">').concat(n).concat(t,'</div>\n              <i class="ux-dialog--loading"></i>\n            </div>\n            <i class="ux-dialog--dim"></i>\n          </div>\n        ');return c.htmlToElement(o)}},{key:"append",value:function(e){var n=document.body;this.element=this.makeNode(e),n.appendChild(this.element)}},{key:"getDefaultContents",value:function(e){var n=this;this.checkType(e),this.element=null,this.contents={},Object.entries(e).map(function(e){n.contents[e[0]]=e[1]})}},{key:"bindEvent",value:function(n){var t=this;window.onkeyup&&c.keyUpEvents.push(window.onkeyup),window.onkeyup=function(e){if(n.closeKey!==e.keyCode)return n.cancelKey===e.keyCode?(n.cancel.callback&&n.cancel.callback(),void t.close()):void(n.confirmKey!==e.keyCode||n.confirm.callback&&n.confirm.callback());t.close()},n.dimClose&&(this.element.querySelector(".ux-dialog--dim").onclick=function(){t.close()}),this.element.querySelector(".ux-dialog--close").onclick=function(){t.close()},this.element.querySelector(".ux-dialog--footer").onclick=function(e){switch(e.target.name){case"confirm":n.confirm.callback&&n.confirm.callback();break;case"cancel":t.close(),n.cancel.callback&&n.cancel.callback()}}}},{key:"open",value:function(e){var o=this;if(null===this.element){var c=Object.assign({},this.contents);if(e&&(this.checkType(e),Object.entries(e).map(function(e){var n=e[0],t=e[1];o.contents[n]!==t&&(c[n]=t)})),this.append(c),this.bindEvent(c),c.opend){this.element.querySelector(".ux-dialog--dim").addEventListener("animationend",function e(){o.element.querySelector(".ux-dialog--dim").removeEventListener("animationend",e),c.opend()})}c.selfClose&&(clearTimeout(this.sto),this.element.querySelector(".ux-dialog--loading").style.animationDuration=c.selfClose/1e3+"s",this.sto=setTimeout(function(){o.close()},c.selfClose))}}},{key:"close",value:function(e){var n=this,t=this.element;if(t){var o=c.keyUpEvents.length;window.onkeyup=o?c.keyUpEvents.pop():null,t.classList.add("close"),t.querySelector(".ux-dialog--dim").addEventListener("animationend",function(){n.contents.closed&&n.contents.closed(),e&&e(),t.remove()}),this.element=null}}}],[{key:"htmlToElement",value:function(e){var n=document.createElement("template");return e=e.trim(),n.innerHTML=e,n.content.firstChild}}]),c}(),_default=UxDialog;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIiwidXgtZGlhbG9nLmJhc2UuanMiXSwibmFtZXMiOlsiZGVmYXVsdFRleHQiLCJjb25maXJtIiwiY2FuY2VsIiwiY29udGVudHNUeXBlIiwiY2xvc2UiLCJkaW1DbG9zZSIsInRpdGxlIiwiY29udGVudCIsImNhbGxiYWNrIiwidGV4dCIsInNlbGZDbG9zZSIsImNsb3NlS2V5IiwiY2FuY2VsS2V5IiwiY29uZmlybUtleSIsIm9wZW5kIiwiY2xvc2VkIiwiVXhEaWFsb2ciLCJjb250ZW50cyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJrZXlVcEV2ZW50cyIsImdldERlZmF1bHRDb250ZW50cyIsIm9iamVjdCIsIl90aGlzIiwiT2JqZWN0IiwiZW50cmllcyIsIm1hcCIsInZhbCIsImtleSIsInZhbHVlIiwiX3R5cGVvZiIsImNoZWNrVHlwZSIsInR5cGUiLCJjb25jYXQiLCJkaWFsb2ciLCJodG1sVG9FbGVtZW50IiwiYm9keSIsImRvY3VtZW50IiwiZWxlbWVudCIsIm1ha2VOb2RlIiwiYXBwZW5kQ2hpbGQiLCJfdGhpczIiLCJfdGhpczMiLCJ3aW5kb3ciLCJvbmtleXVwIiwicHVzaCIsImUiLCJrZXlDb2RlIiwicXVlcnlTZWxlY3RvciIsIm9uY2xpY2siLCJ0YXJnZXQiLCJuYW1lIiwiX3RoaXM0Iiwib25jZSIsImFzc2lnbiIsImFwcGVuZCIsImJpbmRFdmVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhY3Rpb24iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2xlYXJUaW1lb3V0Iiwic3RvIiwic3R5bGUiLCJhbmltYXRpb25EdXJhdGlvbiIsInNldFRpbWVvdXQiLCJfdGhpczUiLCJrZXlVcExlbmd0aCIsImxlbmd0aCIsInBvcCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInN0ciIsInRlbXBsYXRlIiwiY3JlYXRlRWxlbWVudCIsInRyaW0iLCJpbm5lckhUTUwiLCJmaXJzdENoaWxkIl0sIm1hcHBpbmdzIjoiOzs7OztzdEJBb0JBLElBQU1BLFlBQWMsQ0FDaEJDLFFBQVMsS0FDVEMsT0FBUSxNQUdOQyxhQUFlLENBQ2pCRixRQUFTLFVBQ1RDLE9BQVEsVUFDUkUsTUFBTyxVQUNQQyxTQUFVLFVBQ1ZDLE1BQU8sU0FDUEMsUUFBUyxTQUNUQyxTQUFVLFdBQ1ZDLEtBQU0sU0FDTkMsVUFBVyxTQUNYQyxTQUFVLFNBQ1ZDLFVBQVcsU0FDWEMsV0FBWSxTQUNaQyxNQUFPLFdBQ1BDLE9BQVEsWUFHTkMsb0JBTUYsU0FBQUEsRUFBWUMsR0FBa0JDLGdCQUFBQyxLQUFBSCxHQUNyQkEsRUFBU0ksY0FDVkosRUFBU0ksWUFBYyxJQUUzQkQsS0FBS0UsbUJBQW1CSixHQUFZLDJEQUd0QkssR0FBYyxJQUFBQyxFQUFBSixLQUM1QkssT0FBT0MsUUFBUUgsR0FBUUksSUFBSSxTQUFDQyxHQUN4QixJQUFNQyxFQUFNRCxFQUFJLEdBQ1ZFLEVBQVFGLEVBQUksR0FDbEIsR0FBcUIsV0FBakJHLFFBQU9ELEdBQ1BOLEVBQUtRLFVBQVVGLE9BQ1osQ0FDSCxJQUFNRyxFQUFPN0IsYUFBYXlCLEdBQzFCLEdBQUlFLFFBQU9ELEtBQVVHLEVBQ2pCLEtBQUEsR0FBQUMsT0FBU0osRUFBVCxNQUFBSSxPQUFtQkQsRUFBbkIsK0NBTUNmLEdBQ2IsSUFBSWhCLEVBQVUsR0FDVkMsRUFBUyxHQUNUZSxFQUFTaEIsVUFDVEEsRUFBTyx3Q0FBQWdDLE9BQTJDaEIsRUFBU2hCLFFBQVFRLE1BQVFULFlBQVlDLFFBQWhGLGNBRVBnQixFQUFTZixTQUNUQSxFQUFNLHVDQUFBK0IsT0FBMENoQixFQUFTZixPQUFPTyxNQUFRVCxZQUFZRSxPQUE5RSxjQUVWLElBQU1nQyxFQUFNLG9KQUFBRCxRQUcrRCxJQUFuQmhCLEVBQVNiLE9BQXFCLHlCQUgxRSw4RUFBQTZCLE9BSTJCaEIsRUFBU1gsTUFKcEMsNERBQUEyQixPQUs4QmhCLEVBQVNWLFFBTHZDLHlEQUFBMEIsT0FNMkJoQyxHQU4zQmdDLE9BTXFDL0IsRUFOckMsd0pBWVosT0FBT2MsRUFBU21CLGNBQWNELGtDQVVuQmpCLEdBQ1gsSUFBTW1CLEVBQU9DLFNBQVNELEtBQ3RCakIsS0FBS21CLFFBQVVuQixLQUFLb0IsU0FBU3RCLEdBQzdCbUIsRUFBS0ksWUFBWXJCLEtBQUttQixvREFHQ3JCLEdBQWtCLElBQUF3QixFQUFBdEIsS0FDekNBLEtBQUtZLFVBQVVkLEdBQ2ZFLEtBQUttQixRQUFVLEtBQ2ZuQixLQUFLRixTQUFXLEdBQ2hCTyxPQUFPQyxRQUFRUixHQUFVUyxJQUFJLFNBQUNDLEdBQzFCYyxFQUFLeEIsU0FBU1UsRUFBSSxJQUFNQSxFQUFJLHVDQUlsQlYsR0FBbUIsSUFBQXlCLEVBQUF2QixLQUM3QndCLE9BQU9DLFNBQ1A1QixFQUFTSSxZQUFZeUIsS0FBS0YsT0FBT0MsU0FFckNELE9BQU9DLFFBQVUsU0FBQUUsR0FDYixHQUFJN0IsRUFBU04sV0FBYW1DLEVBQUVDLFFBSTVCLE9BQUk5QixFQUFTTCxZQUFja0MsRUFBRUMsU0FDeEI5QixFQUFTZixPQUFPTSxVQUFjUyxFQUFTZixPQUFPTSxnQkFDL0NrQyxFQUFLdEMsY0FHTGEsRUFBU0osYUFBZWlDLEVBQUVDLFNBQ3pCOUIsRUFBU2hCLFFBQVFPLFVBQWNTLEVBQVNoQixRQUFRTyxZQVRqRGtDLEVBQUt0QyxTQWFUYSxFQUFTWixXQUNUYyxLQUFLbUIsUUFBUVUsY0FBYyxtQkFBbUJDLFFBQVUsV0FDcERQLEVBQUt0QyxVQUdiZSxLQUFLbUIsUUFBUVUsY0FBYyxxQkFBcUJDLFFBQVUsV0FDdERQLEVBQUt0QyxTQUVUZSxLQUFLbUIsUUFBUVUsY0FBYyxzQkFBc0JDLFFBQVUsU0FBQ0gsR0FFeEQsT0FEYUEsRUFBRUksT0FBT0MsTUFFbEIsSUFBSyxVQUNBbEMsRUFBU2hCLFFBQVFPLFVBQWNTLEVBQVNoQixRQUFRTyxXQUNqRCxNQUNKLElBQUssU0FDRGtDLEVBQUt0QyxRQUNKYSxFQUFTZixPQUFPTSxVQUFjUyxFQUFTZixPQUFPTSwwQ0FNbkRTLEdBQW1CLElBQUFtQyxFQUFBakMsS0FDM0IsR0FBcUIsT0FBakJBLEtBQUttQixRQUFrQixDQUN2QixJQUFJZSxFQUFpQjdCLE9BQU84QixPQUFPLEdBQUluQyxLQUFLRixVQWE1QyxHQVpJQSxJQUNBRSxLQUFLWSxVQUFVZCxHQUNmTyxPQUFPQyxRQUFRUixHQUFVUyxJQUFJLFNBQUNDLEdBQzFCLElBQU1DLEVBQU1ELEVBQUksR0FDVkUsRUFBUUYsRUFBSSxHQUNkeUIsRUFBS25DLFNBQVNXLEtBQVNDLElBQ3ZCd0IsRUFBS3pCLEdBQU9DLE1BSXhCVixLQUFLb0MsT0FBT0YsR0FDWmxDLEtBQUtxQyxVQUFVSCxHQUNYQSxFQUFLdkMsTUFBTyxDQUtaSyxLQUFLbUIsUUFBUVUsY0FBYyxtQkFBbUJTLGlCQUFpQixlQUpoRCxTQUFUQyxJQUNGTixFQUFLZCxRQUFRVSxjQUFjLG1CQUFtQlcsb0JBQW9CLGVBQWdCRCxHQUNsRkwsRUFBS3ZDLFVBSVR1QyxFQUFLM0MsWUFDTGtELGFBQWF6QyxLQUFLMEMsS0FDbEIxQyxLQUFLbUIsUUFBUVUsY0FBYyx1QkFBdUJjLE1BQU1DLGtCQUFvQlYsRUFBSzNDLFVBQVksSUFBTyxJQUNwR1MsS0FBSzBDLElBQU1HLFdBQVcsV0FDbEJaLEVBQUtoRCxTQUNOaUQsRUFBSzNDLDJDQUtQRixHQUFtQixJQUFBeUQsRUFBQTlDLEtBQ3RCbUIsRUFBVW5CLEtBQUttQixRQUNyQixHQUFJQSxFQUFTLENBQ1QsSUFBTTRCLEVBQWNsRCxFQUFTSSxZQUFZK0MsT0FFckN4QixPQUFPQyxRQURQc0IsRUFDaUJsRCxFQUFTSSxZQUFZZ0QsTUFFckIsS0FFckI5QixFQUFRK0IsVUFBVUMsSUFBSSxTQUN0QmhDLEVBQVFVLGNBQWMsbUJBQW1CUyxpQkFBaUIsZUFBZ0IsV0FDbEVRLEVBQUtoRCxTQUFTRixRQUNka0QsRUFBS2hELFNBQVNGLFNBRWRQLEdBQ0FBLElBRUo4QixFQUFRaUMsV0FFWnBELEtBQUttQixRQUFVLDhDQWxIRmtDLEdBQ2pCLElBQU1DLEVBQVdwQyxTQUFTcUMsY0FBYyxZQUd4QyxPQUZBRixFQUFNQSxFQUFJRyxPQUNWRixFQUFTRyxVQUFZSixFQUNkQyxFQUFTbEUsUUFBUXNFLDZCQ2tGakI3RCIsImZpbGUiOiJ1eC1kaWFsb2cubXZjLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImludGVyZmFjZSBCdXR0b24ge1xuICAgIGNhbGxiYWNrPzogRnVuY3Rpb247XG4gICAgdGV4dD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIENvbnRlbnRzIHtcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICBjb250ZW50Pzogc3RyaW5nIHwgTm9kZTtcbiAgICBjb25maXJtPzogQnV0dG9uIHwgbnVsbDtcbiAgICBjYW5jZWw/OiBCdXR0b24gfCBudWxsO1xuICAgIGNsb3NlPzogYm9vbGVhbjtcbiAgICBkaW1DbG9zZT86IGJvb2xlYW47XG4gICAgc2VsZkNsb3NlPzogbnVtYmVyO1xuICAgIGNsb3NlS2V5PzogbnVtYmVyO1xuICAgIGNhbmNlbEtleT86IG51bWJlcjtcbiAgICBjb25maXJtS2V5PzogbnVtYmVyO1xuICAgIG9wZW5kPzogRnVuY3Rpb247XG4gICAgY2xvc2VkPzogRnVuY3Rpb247XG59XG5cbmNvbnN0IGRlZmF1bHRUZXh0ID0ge1xuICAgIGNvbmZpcm06ICftmZXsnbgnLFxuICAgIGNhbmNlbDogJ+y3qOyGjCdcbn07XG5cbmNvbnN0IGNvbnRlbnRzVHlwZSA9IHtcbiAgICBjb25maXJtOiAnYm9vbGVhbicsXG4gICAgY2FuY2VsOiAnYm9vbGVhbicsXG4gICAgY2xvc2U6ICdib29sZWFuJyxcbiAgICBkaW1DbG9zZTogJ2Jvb2xlYW4nLFxuICAgIHRpdGxlOiAnc3RyaW5nJyxcbiAgICBjb250ZW50OiAnc3RyaW5nJyxcbiAgICBjYWxsYmFjazogJ2Z1bmN0aW9uJyxcbiAgICB0ZXh0OiAnc3RyaW5nJyxcbiAgICBzZWxmQ2xvc2U6ICdudW1iZXInLFxuICAgIGNsb3NlS2V5OiAnbnVtYmVyJyxcbiAgICBjYW5jZWxLZXk6ICdudW1iZXInLFxuICAgIGNvbmZpcm1LZXk6ICdudW1iZXInLFxuICAgIG9wZW5kOiAnZnVuY3Rpb24nLFxuICAgIGNsb3NlZDogJ2Z1bmN0aW9uJyxcbn07XG5cbmNsYXNzIFV4RGlhbG9nIHtcbiAgICBzdGF0aWMga2V5VXBFdmVudHM6IGFueVtdO1xuICAgIHByaXZhdGUgc3RvOiBhbnk7XG4gICAgcHJpdmF0ZSBlbGVtZW50OiBhbnk7XG4gICAgcHJpdmF0ZSBjb250ZW50czogQ29udGVudHM7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250ZW50czogQ29udGVudHMpIHtcbiAgICAgICAgaWYgKCFVeERpYWxvZy5rZXlVcEV2ZW50cykge1xuICAgICAgICAgICAgVXhEaWFsb2cua2V5VXBFdmVudHMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdldERlZmF1bHRDb250ZW50cyhjb250ZW50cyB8fCB7fSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja1R5cGUob2JqZWN0OiBvYmplY3QpOiB2b2lkIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMob2JqZWN0KS5tYXAoKHZhbCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gdmFsWzBdO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWxbMV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGNvbnRlbnRzVHlwZVtrZXldO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgYCR7dmFsdWV964qUICR7dHlwZX3snbQg7JWE64uZ64uI64ukLmBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFrZU5vZGUoY29udGVudHM6IENvbnRlbnRzKTogYW55IHtcbiAgICAgICAgbGV0IGNvbmZpcm0gPSAnJztcbiAgICAgICAgbGV0IGNhbmNlbCA9ICcnO1xuICAgICAgICBpZiAoY29udGVudHMuY29uZmlybSkge1xuICAgICAgICAgICAgY29uZmlybSA9IGA8YnV0dG9uIG5hbWU9XCJjb25maXJtXCIgdHlwZT1cImJ1dHRvblwiPiR7Y29udGVudHMuY29uZmlybS50ZXh0IHx8IGRlZmF1bHRUZXh0LmNvbmZpcm19PC9idXR0b24+YFxuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZW50cy5jYW5jZWwpIHtcbiAgICAgICAgICAgIGNhbmNlbCA9IGA8YnV0dG9uIG5hbWU9XCJjYW5jZWxcIiB0eXBlPVwiYnV0dG9uXCI+JHtjb250ZW50cy5jYW5jZWwudGV4dCB8fCBkZWZhdWx0VGV4dC5jYW5jZWx9PC9idXR0b24+YFxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IGAgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZ1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tY29udGVudFwiPlxuICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInV4LWRpYWxvZy0tY2xvc2VcIiAkeyhjb250ZW50cy5jbG9zZSA9PT0gZmFsc2UpICYmICgnc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiJyl9PnRoaXMgZGlhbG9nIGNsb3NlPC9idXR0b24+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1eC1kaWFsb2ctLWhlYWRlclwiPiR7Y29udGVudHMudGl0bGV9PC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1eC1kaWFsb2ctLWNvbnRhaW5lclwiPiR7Y29udGVudHMuY29udGVudH08L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tZm9vdGVyXCI+JHtjb25maXJtfSR7Y2FuY2VsfTwvZGl2PlxuICAgICAgICAgICAgICA8aSBjbGFzcz1cInV4LWRpYWxvZy0tbG9hZGluZ1wiPjwvaT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGkgY2xhc3M9XCJ1eC1kaWFsb2ctLWRpbVwiPjwvaT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgcmV0dXJuIFV4RGlhbG9nLmh0bWxUb0VsZW1lbnQoZGlhbG9nKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaHRtbFRvRWxlbWVudChzdHI6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcbiAgICAgICAgc3RyID0gc3RyLnRyaW0oKTtcbiAgICAgICAgdGVtcGxhdGUuaW5uZXJIVE1MID0gc3RyO1xuICAgICAgICByZXR1cm4gdGVtcGxhdGUuY29udGVudC5maXJzdENoaWxkO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXBwZW5kKGNvbnRlbnRzOiBDb250ZW50cykge1xuICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5tYWtlTm9kZShjb250ZW50cyk7XG4gICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERlZmF1bHRDb250ZW50cyhjb250ZW50czogQ29udGVudHMpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jaGVja1R5cGUoY29udGVudHMpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmNvbnRlbnRzID0ge307XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGNvbnRlbnRzKS5tYXAoKHZhbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb250ZW50c1t2YWxbMF1dID0gdmFsWzFdO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJpbmRFdmVudChjb250ZW50cz86IENvbnRlbnRzKSB7XG4gICAgICAgIGlmICh3aW5kb3cub25rZXl1cCkge1xuICAgICAgICAgICAgVXhEaWFsb2cua2V5VXBFdmVudHMucHVzaCh3aW5kb3cub25rZXl1cCk7XG4gICAgICAgIH1cbiAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBlID0+IHtcbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jbG9zZUtleSA9PT0gZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jYW5jZWxLZXkgPT09IGUua2V5Q29kZSkge1xuICAgICAgICAgICAgICAgIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2spICYmIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2soKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jb25maXJtS2V5ID09PSBlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaykgJiYgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2soKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAoY29udGVudHMuZGltQ2xvc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWNsb3NlJykub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWZvb3RlcicpLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGUudGFyZ2V0Lm5hbWU7XG4gICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjb25maXJtJzpcbiAgICAgICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2spICYmIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdjYW5jZWwnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2spICYmIChjb250ZW50cy5jYW5jZWwuY2FsbGJhY2soKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9wZW4oY29udGVudHM/OiBDb250ZW50cyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgb25jZTogQ29udGVudHMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbnRlbnRzKTtcbiAgICAgICAgICAgIGlmIChjb250ZW50cykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tUeXBlKGNvbnRlbnRzKTtcbiAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhjb250ZW50cykubWFwKCh2YWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gdmFsWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbFsxXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudHNba2V5XSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2Vba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmFwcGVuZChvbmNlKTtcbiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50KG9uY2UpO1xuICAgICAgICAgICAgaWYgKG9uY2Uub3BlbmQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5yZW1vdmVFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCBhY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICBvbmNlLm9wZW5kKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tZGltJykuYWRkRXZlbnRMaXN0ZW5lcignYW5pbWF0aW9uZW5kJywgYWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvbmNlLnNlbGZDbG9zZSkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnN0byk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWxvYWRpbmcnKS5zdHlsZS5hbmltYXRpb25EdXJhdGlvbiA9IG9uY2Uuc2VsZkNsb3NlIC8gMTAwMCArICdzJztcbiAgICAgICAgICAgICAgICB0aGlzLnN0byA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSwgb25jZS5zZWxmQ2xvc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNsb3NlKGNhbGxiYWNrPzogRnVuY3Rpb24pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleVVwTGVuZ3RoID0gVXhEaWFsb2cua2V5VXBFdmVudHMubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGtleVVwTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBVeERpYWxvZy5rZXlVcEV2ZW50cy5wb3AoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjbG9zZScpO1xuICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudHMuY2xvc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGVudHMuY2xvc2VkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4iLCJjb25zdCBkZWZhdWx0VGV4dCA9IHtcbiAgICBjb25maXJtOiAn7ZmV7J24JyxcbiAgICBjYW5jZWw6ICfst6jshownXG59O1xuY29uc3QgY29udGVudHNUeXBlID0ge1xuICAgIGNvbmZpcm06ICdib29sZWFuJyxcbiAgICBjYW5jZWw6ICdib29sZWFuJyxcbiAgICBjbG9zZTogJ2Jvb2xlYW4nLFxuICAgIGRpbUNsb3NlOiAnYm9vbGVhbicsXG4gICAgdGl0bGU6ICdzdHJpbmcnLFxuICAgIGNvbnRlbnQ6ICdzdHJpbmcnLFxuICAgIGNhbGxiYWNrOiAnZnVuY3Rpb24nLFxuICAgIHRleHQ6ICdzdHJpbmcnLFxuICAgIHNlbGZDbG9zZTogJ251bWJlcicsXG4gICAgY2xvc2VLZXk6ICdudW1iZXInLFxuICAgIGNhbmNlbEtleTogJ251bWJlcicsXG4gICAgY29uZmlybUtleTogJ251bWJlcicsXG4gICAgb3BlbmQ6ICdmdW5jdGlvbicsXG4gICAgY2xvc2VkOiAnZnVuY3Rpb24nLFxufTtcbmNsYXNzIFV4RGlhbG9nIHtcbiAgICBjb25zdHJ1Y3Rvcihjb250ZW50cykge1xuICAgICAgICBpZiAoIVV4RGlhbG9nLmtleVVwRXZlbnRzKSB7XG4gICAgICAgICAgICBVeERpYWxvZy5rZXlVcEV2ZW50cyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzIHx8IHt9KTtcbiAgICB9XG4gICAgY2hlY2tUeXBlKG9iamVjdCkge1xuICAgICAgICBPYmplY3QuZW50cmllcyhvYmplY3QpLm1hcCgodmFsKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSB2YWxbMF07XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbFsxXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1R5cGUodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGNvbnRlbnRzVHlwZVtrZXldO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgYCR7dmFsdWV964qUICR7dHlwZX3snbQg7JWE64uZ64uI64ukLmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgbWFrZU5vZGUoY29udGVudHMpIHtcbiAgICAgICAgbGV0IGNvbmZpcm0gPSAnJztcbiAgICAgICAgbGV0IGNhbmNlbCA9ICcnO1xuICAgICAgICBpZiAoY29udGVudHMuY29uZmlybSkge1xuICAgICAgICAgICAgY29uZmlybSA9IGA8YnV0dG9uIG5hbWU9XCJjb25maXJtXCIgdHlwZT1cImJ1dHRvblwiPiR7Y29udGVudHMuY29uZmlybS50ZXh0IHx8IGRlZmF1bHRUZXh0LmNvbmZpcm19PC9idXR0b24+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGVudHMuY2FuY2VsKSB7XG4gICAgICAgICAgICBjYW5jZWwgPSBgPGJ1dHRvbiBuYW1lPVwiY2FuY2VsXCIgdHlwZT1cImJ1dHRvblwiPiR7Y29udGVudHMuY2FuY2VsLnRleHQgfHwgZGVmYXVsdFRleHQuY2FuY2VsfTwvYnV0dG9uPmA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGlhbG9nID0gYCBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1jb250ZW50XCI+XG4gICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwidXgtZGlhbG9nLS1jbG9zZVwiICR7KGNvbnRlbnRzLmNsb3NlID09PSBmYWxzZSkgJiYgKCdzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCInKX0+dGhpcyBkaWFsb2cgY2xvc2U8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0taGVhZGVyXCI+JHtjb250ZW50cy50aXRsZX08L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInV4LWRpYWxvZy0tY29udGFpbmVyXCI+JHtjb250ZW50cy5jb250ZW50fTwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXgtZGlhbG9nLS1mb290ZXJcIj4ke2NvbmZpcm19JHtjYW5jZWx9PC9kaXY+XG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwidXgtZGlhbG9nLS1sb2FkaW5nXCI+PC9pPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8aSBjbGFzcz1cInV4LWRpYWxvZy0tZGltXCI+PC9pPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgICAgICByZXR1cm4gVXhEaWFsb2cuaHRtbFRvRWxlbWVudChkaWFsb2cpO1xuICAgIH1cbiAgICBzdGF0aWMgaHRtbFRvRWxlbWVudChzdHIpIHtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgICAgICBzdHIgPSBzdHIudHJpbSgpO1xuICAgICAgICB0ZW1wbGF0ZS5pbm5lckhUTUwgPSBzdHI7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZS5jb250ZW50LmZpcnN0Q2hpbGQ7XG4gICAgfVxuICAgIGFwcGVuZChjb250ZW50cykge1xuICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5tYWtlTm9kZShjb250ZW50cyk7XG4gICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcbiAgICB9XG4gICAgZ2V0RGVmYXVsdENvbnRlbnRzKGNvbnRlbnRzKSB7XG4gICAgICAgIHRoaXMuY2hlY2tUeXBlKGNvbnRlbnRzKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jb250ZW50cyA9IHt9O1xuICAgICAgICBPYmplY3QuZW50cmllcyhjb250ZW50cykubWFwKCh2YWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudHNbdmFsWzBdXSA9IHZhbFsxXTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGJpbmRFdmVudChjb250ZW50cykge1xuICAgICAgICBpZiAod2luZG93Lm9ua2V5dXApIHtcbiAgICAgICAgICAgIFV4RGlhbG9nLmtleVVwRXZlbnRzLnB1c2god2luZG93Lm9ua2V5dXApO1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5vbmtleXVwID0gZSA9PiB7XG4gICAgICAgICAgICBpZiAoY29udGVudHMuY2xvc2VLZXkgPT09IGUua2V5Q29kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29udGVudHMuY2FuY2VsS2V5ID09PSBlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29udGVudHMuY29uZmlybUtleSA9PT0gZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICAgICAgKGNvbnRlbnRzLmNvbmZpcm0uY2FsbGJhY2spICYmIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGNvbnRlbnRzLmRpbUNsb3NlKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tZGltJykub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1jbG9zZScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1mb290ZXInKS5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBlLnRhcmdldC5uYW1lO1xuICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnY29uZmlybSc6XG4gICAgICAgICAgICAgICAgICAgIChjb250ZW50cy5jb25maXJtLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY29uZmlybS5jYWxsYmFjaygpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY2FuY2VsJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKSAmJiAoY29udGVudHMuY2FuY2VsLmNhbGxiYWNrKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgb3Blbihjb250ZW50cykge1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgb25jZSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29udGVudHMpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1R5cGUoY29udGVudHMpO1xuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGNvbnRlbnRzKS5tYXAoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB2YWxbMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdmFsWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250ZW50c1trZXldICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25jZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYXBwZW5kKG9uY2UpO1xuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQob25jZSk7XG4gICAgICAgICAgICBpZiAob25jZS5vcGVuZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy51eC1kaWFsb2ctLWRpbScpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FuaW1hdGlvbmVuZCcsIGFjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIG9uY2Uub3BlbmQoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudXgtZGlhbG9nLS1kaW0nKS5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCBhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9uY2Uuc2VsZkNsb3NlKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc3RvKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tbG9hZGluZycpLnN0eWxlLmFuaW1hdGlvbkR1cmF0aW9uID0gb25jZS5zZWxmQ2xvc2UgLyAxMDAwICsgJ3MnO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9LCBvbmNlLnNlbGZDbG9zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2UoY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleVVwTGVuZ3RoID0gVXhEaWFsb2cua2V5VXBFdmVudHMubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGtleVVwTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9ua2V5dXAgPSBVeERpYWxvZy5rZXlVcEV2ZW50cy5wb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5vbmtleXVwID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2xvc2UnKTtcbiAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnV4LWRpYWxvZy0tZGltJykuYWRkRXZlbnRMaXN0ZW5lcignYW5pbWF0aW9uZW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRzLmNsb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRzLmNsb3NlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVXhEaWFsb2c7Il19
